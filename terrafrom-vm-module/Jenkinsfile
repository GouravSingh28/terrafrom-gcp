pipeline {
    agent any
    parameters {
        string(name: 'SERVER_IP', defaultValue: '', description: 'Enter the IP address of the target server')
        string(name: 'Username', defaultValue: 'gouravsingh335', description: 'Enter username for  login')
    }
    environment {
        SSH_CREDENTIALS_ID = 'ssh-key' // Replace with your Jenkins SSH credentials ID
        INSTALL_SCRIPT = './install-script.sh'  // Update with the path to your installation script
    }
    stages {
        stage('Validate Input') {
            steps {
                script {
                    if (params.SERVER_IP == '') {
                        error("SERVER_IP parameter is required.")
                    }
                }
            }
        }

        stage('Run Installation Script') {
            steps {
                sshCommand remote: [
                    name: 'Target Server',
                    host: "${SERVER_IP}",
                    user: "${Username}",, // Update with the SSH username
                    credentialsId: "${SSH_CREDENTIALS_ID}"
                ], command: '''
                    # Transfer the installation script
                    scp ${INSTALL_SCRIPT} ${USER}@${SERVER_IP}:/tmp/install-script.sh
                    
                    # Run the script on the remote server
                    ssh ${USER}@${SERVER_IP} 'bash /tmp/install-script.sh'
                '''
            }
        }
    }
    post {
        success {
            echo "Installation script executed successfully on ${SERVER_IP}."
        }
        failure {
            echo "Failed to run the installation script on ${SERVER_IP}."
        }
    }
}
